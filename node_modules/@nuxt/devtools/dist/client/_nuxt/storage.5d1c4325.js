import{_ as se}from"./NIconButton.vue.b41ef4b9.js";import{_ as re}from"./NSelect.vue.80dc04cd.js";import{g as J,D as le,r as j,l as q,E,b5 as T,am as ue,a6 as ie,al as ce,L as de,z as p,A as h,q as n,o as r,h as _,w as l,a as u,b as c,I as D,c as d,F as w,m as U,t as k,n as z,d as i,aN as L,s as F,ah as me,x as _e,aX as pe,b6 as fe,b7 as ye,b8 as G,J as ve,e as ge,P as he,j as ke,a8 as be}from"./entry.11fe2cd7.js";import{_ as xe}from"./NLink.vue.8c655f8a.js";import{_ as we}from"./NPanelGrids.16564aae.js";import{_ as Ke}from"./PanelLeftRight.vue.17bcbe2c.js";import{_ as Ce}from"./FilepathItem.vue.b4bdb03f.js";import{U as Ne}from"./json-editor-vue.51bb18e8.js";import{_ as Ve}from"./AuthRequiredPanel.vue.783e1d98.js";const $e={class:"h-[48px] flex items-center justify-between gap1 px-3"},Se={class:"w-full text-sm"},Ie=["value"],je=u("div",{"x-divider":""},null,-1),qe={key:0,"h-full":"","of-hidden":"",flex:"~ col"},De={border:"b base",class:"h-[49px] flex flex-none items-center justify-between px-4 text-sm"},Ue={class:"flex items-center gap-4"},Le={key:1},Ae=["onKeyup"],Be=u("br",null,null,-1),Me={key:0,op50:""},Pe={key:1},Re=u("code",null,"nitro.storage",-1),Ee=u("br",null,null,-1),Te={"font-bold":""},ze=u("br",null,null,-1),Fe={"text-sm":""},Ge=u("br",null,null,-1),Je=J({__name:"StorageDetails",async setup(O){let m,g;const K=ye(),y=le(),b=j(""),v=j(""),s=q({get(){return E().query?.storage},set(t){y.replace({query:{storage:t}})}}),e=j(),x=q(()=>E().query?.key),{data:C}=([m,g]=T(()=>G("storageMounts",()=>p.getStorageMounts())),m=await m,g(),m),{data:N,refresh:A}=([m,g]=T(async()=>G("storageKeys",async()=>s.value?await p.getStorageKeys(s.value):[])),m=await m,g(),m),W=K.hook("storage:key:update",async(t,o)=>{if(!(!s.value||t.split(":")[0]!==s.value)&&(await A(),x.value===t)){if(o==="remove")return y.replace({query:{storage:s.value}});await $(x.value)}});ue(W),ie(s,A),ce(async()=>{if(!x.value){e.value=null;return}$(x.value)}),de("keydown",t=>{t.key==="s"&&(t.ctrlKey||t.metaKey)&&(S(),t.preventDefault())});function V(t){return t.replace(`${s.value}:`,"")}const X=q(()=>N.value?N.value.filter(t=>t.includes(b.value)):[]);async function $(t){const o=await p.getStorageItem(await h(),t);e.value={key:t,updatedKey:V(t),editingKey:!1,content:o,updatedContent:o}}async function H(){if(!v.value||!s.value)return;const t=`${s.value}:${v.value}`;N.value?.includes(t)||await p.setStorageItem(await h(),t,""),y.replace({query:{storage:s.value,key:t}}),v.value=""}async function S(){e.value&&(await p.setStorageItem(await h(),e.value.key,e.value.updatedContent),await $(e.value.key))}async function Q(){!e.value||!s.value||(await p.removeStorageItem(await h(),e.value.key),e.value=null)}async function Y(){if(!e.value||!s.value)return;const t=`${s.value}:${e.value.updatedKey}`,o=await h();await p.setStorageItem(o,t,e.value.updatedContent),await p.removeStorageItem(o,e.value.key),y.replace({query:{storage:s.value,key:t}})}return(t,o)=>{const Z=se,ee=re,I=ve,te=ge,ne=he,B=ke,M=xe,P=be,R=we,oe=Ke,ae=Ce;return n(s)?(r(),_(oe,{key:0,"storage-key":"tab-storage"},{left:l(()=>[u("div",$e,[c(Z,{icon:"carbon-chevron-left","ml--1":"",onClick:o[0]||(o[0]=a=>s.value="")}),u("div",Se,[c(ee,{modelValue:n(s),"onUpdate:modelValue":o[1]||(o[1]=a=>D(s)?s.value=a:null),n:"primary",icon:"carbon-data-base"},{default:l(()=>[(r(!0),d(w,null,U(n(C),(a,f)=>(r(),d("option",{key:f,value:f},k(f),9,Ie))),128))]),_:1},8,["modelValue"])])]),c(I,{modelValue:n(b),"onUpdate:modelValue":o[2]||(o[2]=a=>D(b)?b.value=a:null),icon:"carbon-search",placeholder:"Search...",n:"primary sm",border:"y x-none base! rounded-0",class:"w-full py2 ring-0!"},null,8,["modelValue"]),(r(!0),d(w,null,U(n(X),a=>(r(),d(w,{key:a},[c(te,{block:"",truncate:"",px2:"",py1:"","text-sm":"","font-mono":"",to:{query:{key:a,storage:n(s)}},class:z(a===n(e)?.key?"text-primary n-bg-active":"text-secondary hover:n-bg-hover")},{default:l(()=>[i(k(V(a)),1)]),_:2},1032,["to","class"]),je],64))),128)),c(I,{modelValue:n(v),"onUpdate:modelValue":o[3]||(o[3]=a=>D(v)?v.value=a:null),icon:"carbon-add",placeholder:"key",n:"sm",border:"t-none x-none base! rounded-0",class:"w-full py2 font-mono ring-0!",onKeyup:L(H,["enter"])},null,8,["modelValue","onKeyup"])]),right:l(()=>[n(e)?.key?(r(),d("div",qe,[u("div",De,[u("div",Ue,[n(e).editingKey?(r(),_(I,{key:0,modelValue:n(e).updatedKey,"onUpdate:modelValue":o[4]||(o[4]=a=>n(e).updatedKey=a),onKeyup:L(Y,["enter"])},null,8,["modelValue","onKeyup"])):(r(),d("code",Le,[i(k(V(n(e).key))+" ",1),c(ne,{icon:"carbon-edit",class:"cursor-pointer op50 hover:op100",onClick:o[5]||(o[5]=a=>n(e).editingKey=!0)})])),n(e).editingKey?F("",!0):(r(),_(B,{key:2,n:"green xs",disabled:n(e).content===n(e).updatedContent,class:z({"border-green":n(e).content!==n(e).updatedContent}),onClick:S},{default:l(()=>[i(" Save ")]),_:1},8,["disabled","class"]))]),u("div",null,[c(B,{n:"red xs",onClick:Q},{default:l(()=>[i(" Delete ")]),_:1})])]),typeof n(e).content=="object"?(r(),_(n(Ne),me({key:0,modelValue:n(e).updatedContent,"onUpdate:modelValue":o[6]||(o[6]=a=>n(e).updatedContent=a),class:[[t.$colorMode.value==="dark"?"jse-theme-dark":"light"],"json-editor-vue h-full of-auto text-sm outline-none"]},t.$attrs,{mode:"text","navigation-bar":!1,indentation:2,"tab-size":2}),null,16,["modelValue","class"])):_e((r(),d("textarea",{key:1,"onUpdate:modelValue":o[7]||(o[7]=a=>n(e).updatedContent=a),placeholder:"Item value...",class:"h-full of-auto p-4 text-sm font-mono outline-none",onKeyup:L(pe(S,["ctrl"]),["enter"])},null,40,Ae)),[[fe,n(e).updatedContent]])])):(r(),_(R,{key:1},{default:l(()=>[c(P,{px6:"",py4:""},{default:l(()=>[i(" Select one key to start."),Be,i("Learn more about "),c(M,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:l(()=>[i(" Nitro storage ")]),_:1})]),_:1})]),_:1}))]),_:1})):(r(),_(R,{key:1},{default:l(()=>[Object.keys(n(C)).length?(r(),d("p",Me," Select one storage to start: ")):(r(),d("p",Pe,[i(" No custom storage defined in "),Re,i("."),Ee,i(" Learn more about "),c(M,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:l(()=>[i(" Nitro storage ")]),_:1})])),(r(!0),d(w,null,U(n(C),(a,f)=>(r(),_(P,{key:f,"min-w-80":"","cursor-pointer":"","p-4":"","text-left":"",hover:"border-green",onClick:Oe=>s.value=f},{default:l(()=>[u("span",Te,k(f),1),ze,u("span",Fe,k(a.driver)+" driver",1),Ge,a.base?(r(),_(ae,{key:0,"text-xs":"",filepath:a.base},null,8,["filepath"])):F("",!0)]),_:2},1032,["onClick"]))),128))]),_:1}))}}}),ot=J({__name:"storage",setup(O){return(m,g)=>{const K=Je,y=Ve;return r(),_(y,null,{default:l(()=>[c(K)]),_:1})}}});export{ot as default};
